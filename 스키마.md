# BeyondStat 데이터베이스 스키마 명세서 (스키마)

BeyondStat 서비스의 데이터 무결성과 정확한 분석을 위한 핵심 데이터베이스 테이블 및 구체화된 뷰(Materialized View)의 상세 명세입니다.

## 개요
이 문서는 시스템 내부의 데이터 흐름과 측정 항목의 정의를 명확히 하여, 향후 기능 추가 및 데이터 쿼리 작성 시 표준 가이드라인 역할을 합니다. 모든 필드는 Supabase PostgreSQL 환경을 기반으로 합니다.

---

## 테이블 상세 설계

### 1. 선수 관리 레이어 (Profile Layer)

#### [MODIFY] profiles (선수 기본 정보)
선수의 인적 사항과 신체 정보를 관리합니다.

| 컬럼명 | 데이터 타입 | 필수(NN) | 설명 |
| :--- | :--- | :--- | :--- |
| `id` | UUID | ✅ | 선수 고유 식별자 (Primary Key) |
| `team_id` | UUID | ✅ | 소속 팀 식별자 (Foreign Key) |
| `name` | TEXT | ✅ | 선수 성명 |
| `position` | TEXT | - | 포지션 (예: FW, MF, DF, GK) |
| `height` | NUMERIC | - | 키 (cm) |
| `weight` | NUMERIC | - | 몸무게 (kg) |
| `created_at` | TIMESTAMPTZ | ✅ | 시스템 등록 일시 |

---

### 2. 측정 데이터 레이어 (Measurement Layer)

#### [MODIFY] measurements (현장 측정 raw 데이터)
다양한 스포츠 과학 장비로부터 수집된 원본 데이터를 저장합니다.

| 컬럼명 | 데이터 타입 | 필수(NN) | 설명 |
| :--- | :--- | :--- | :--- |
| `id` | BIGINT | ✅ | 측정 데이터 고유 ID (Primary Key) |
| `player_id` | UUID | ✅ | 측정 대상 선수 ID (FK to profiles) |
| `team_id` | UUID | ✅ | 측정이 수행된 팀 ID (FK to teams) |
| `test_type` | TEXT | ✅ | 사용 장비명 (ForceDecks, NordBord, 등) |
| `recorded_at` | TIMESTAMPTZ | ✅ | 데이터가 실제로 측정된 시간 |
| `metrics` | JSONB | ✅ | **상세 측정 수치 (JSON 형식)** |
| `created_at` | TIMESTAMPTZ | ✅ | DB 레코드 생성 일시 |

---

### 3. 분석 및 대시보드 레이어 (Analytics Layer)

#### [VIEW] mv_team_stats (팀별 통합 분석 뷰)
대시보드 상단 헤더에 표시되는 팀별 주요 성능 지표 요약입니다.

| 컬럼명 | 데이터 타입 | 설명 |
| :--- | :--- | :--- |
| `team_id` | UUID | 대상 팀 ID |
| `total_players` | BIGINT | 팀 소속 전체 선수 수 |
| `total_tests` | BIGINT | 누적 전체 테스트 건수 |
| `last_activity` | TIMESTAMPTZ | 마지막 측정 활동 시점 |
| `avg_cmj_height` | NUMERIC | 팀 평균 CMJ 도약 높이 |
| `avg_nordbord_force` | NUMERIC | 팀 평균 Nordbord 편심성 힘 수치 |

#### [VIEW] mv_daily_stats (일별 트렌드 분석 뷰)
차트 시각화를 위한 날짜별 활동량 추적 데이터입니다.

| 컬럼명 | 데이터 타입 | 설명 |
| :--- | :--- | :--- |
| `team_id` | UUID | 대상 팀 ID |
| `test_date` | DATE | 측정 기준 날짜 |
| `device_type` | TEXT | 사용된 장비 종류 |
| `test_count` | BIGINT | 당일 측정 건수 |
| `active_players` | BIGINT | 당일 측정에 참여한 고유 선수 수 |

---

## 장비별 측정 항목 상세 (Metrics Definition)

`measurements` 테이블의 `metrics` 컬럼에 저장되는 JSONB 데이터의 내부 키(Key) 값 정의입니다.

| 장비명 (`test_type`) | 상세 키 (`Metric Key`) | 설명 | 단위 |
| :--- | :--- | :--- | :--- |
| **ForceDecks** | `CMJ_Height` | 카운터무브먼트 점프 높이 | cm |
| **ForceDecks** | `SJ_Height` | 스쿼트 점프 높이 | cm |
| **NordBord** | `Nordbord_MaxForce` | 최대 햄스트링 근력 | N |
| **ForceFrame** | `Adductor_MaxForce` | 최대 내전근 근력 | N |
| **SmartSpeed** | `Sprint_10m` | 10m 가속력 구간 기록 | sec |
| **Dynamo** | `Grip_Force` | 좌/우 악력 수치 | kg/N |

---

## 별칭 및 라우팅 정보 (Alias Mapping)

| 구분 | 값 | 비고 |
| :--- | :--- | :--- |
| **URL Alias** | `yoon` | 대시보드 접근용 별칭 |
| **DB UUID** | `37b06214-a6b5-4814-aee5-d3c42a2347cd` | 실제 데이터 조회용 ID |
